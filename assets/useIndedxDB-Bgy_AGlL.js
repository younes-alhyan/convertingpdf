import{r as m}from"./index-8DrkAZ6i.js";const p="conversions",i="files",y=1,E=()=>{const[l,S]=m.useState(null);m.useEffect(()=>{const t=indexedDB.open(p,y);t.onupgradeneeded=e=>{const n=e.target.result;n.objectStoreNames.contains(i)||n.createObjectStore(i)},t.onsuccess=e=>{const n=e.target.result;S(n)},t.onerror=e=>{console.error("IndexedDB error:",e.target.error)}},[]);const f=(t,e)=>new Promise((n,r)=>{if(!l)return r("DB not initialized");const o=l.transaction(i,"readwrite").objectStore(i).put(e,t);o.onsuccess=()=>n(),o.onerror=c=>r(c.target.error)}),D=t=>new Promise((e,n)=>{if(!l)return e(null);const s=l.transaction(i,"readonly").objectStore(i).get(t);s.onsuccess=o=>{const c=o.target;e(c.result||null)},s.onerror=o=>n(o.target.error)}),b=({id:t,original_filename:e,converted_filename:n,conversion_type:r,status:u,created_at:s,completed_at:o,file_size:c,blob:a})=>new Promise((d,x)=>{f(t,a).then(()=>{const g={id:t,original_filename:e,converted_filename:n,conversion_type:r,status:u,created_at:s,completed_at:o,file_size:c};localStorage.setItem(t,JSON.stringify(g)),d()}).catch(g=>x(g))}),w=m.useCallback(async()=>{const t=r=>new Promise((u,s)=>{if(!l)return s("DB not initialized");const a=l.transaction(i,"readwrite").objectStore(i).delete(r);a.onsuccess=()=>u(),a.onerror=d=>s(d.target.error)}),e=async r=>{localStorage.removeItem(r),await t(r)};return(async()=>{const r=[],u=Date.now(),s=Object.keys(localStorage);for(const o of s){const c=localStorage.getItem(o);if(c)try{const a=JSON.parse(c);if(a.completed_at&&u-new Date(a.completed_at).getTime()>=36e5){await e(o);continue}r.push(a)}catch{continue}}return r})()},[l]);return{saveFile:b,getAllFileEntries:w,loadFileFromDB:D}};export{E as u};
